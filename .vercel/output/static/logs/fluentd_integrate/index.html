<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc data-has-sidebar data-theme="dark" class="astro-bguv2lll"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Integrating fluentd | suchcodewow</title><link rel="canonical"/><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/><meta name="generator" content="Astro v4.12.2"/><meta name="generator" content="Starlight v0.25.2"/><meta property="og:title" content="Integrating fluentd"/><meta property="og:type" content="article"/><meta property="og:url"/><meta property="og:locale" content="en"/><meta property="og:description"/><meta property="og:site_name" content="suchcodewow"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Integrating fluentd"/><meta name="twitter:description"/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/_astro/index.BZ_lKDUn.css">
<style>:root{--sl-badge-default-border: var(--sl-color-accent);--sl-badge-default-bg: var(--sl-color-accent-low);--sl-badge-default-text: #fff;--sl-badge-note-border: var(--sl-color-blue);--sl-badge-note-bg: var(--sl-color-blue-low);--sl-badge-note-text: #fff;--sl-badge-danger-border: var(--sl-color-red);--sl-badge-danger-bg: var(--sl-color-red-low);--sl-badge-danger-text: #fff;--sl-badge-success-border: var(--sl-color-green);--sl-badge-success-bg: var(--sl-color-green-low);--sl-badge-success-text: #fff;--sl-badge-caution-border: var(--sl-color-orange);--sl-badge-caution-bg: var(--sl-color-orange-low);--sl-badge-caution-text: #fff;--sl-badge-tip-border: var(--sl-color-purple);--sl-badge-tip-bg: var(--sl-color-purple-low);--sl-badge-tip-text: #fff}[data-theme=light]:root{--sl-badge-default-bg: var(--sl-color-accent-high);--sl-badge-note-bg: var(--sl-color-blue-high);--sl-badge-danger-bg: var(--sl-color-red-high);--sl-badge-success-bg: var(--sl-color-green-high);--sl-badge-caution-bg: var(--sl-color-orange-high);--sl-badge-tip-bg: var(--sl-color-purple-high)}.sl-badge:where(.astro-avdet4wd){display:inline-block;border:1px solid var(--sl-color-border-badge);border-radius:.25rem;font-family:var(--sl-font-system-mono);line-height:normal;color:var(--sl-color-text-badge);background-color:var(--sl-color-bg-badge);overflow-wrap:anywhere}.sidebar-content .sl-badge:where(.astro-avdet4wd){line-height:1;font-size:var(--sl-text-xs);padding:.125rem .375rem}.sidebar-content a[aria-current=page]>.sl-badge:where(.astro-avdet4wd){--sl-color-bg-badge: transparent;--sl-color-border-badge: currentColor;color:inherit}.default:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-default-bg);--sl-color-border-badge: var(--sl-badge-default-border);--sl-color-text-badge: var(--sl-badge-default-text)}.note:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-note-bg);--sl-color-border-badge: var(--sl-badge-note-border);--sl-color-text-badge: var(--sl-badge-note-text)}.danger:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-danger-bg);--sl-color-border-badge: var(--sl-badge-danger-border);--sl-color-text-badge: var(--sl-badge-danger-text)}.success:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-success-bg);--sl-color-border-badge: var(--sl-badge-success-border);--sl-color-text-badge: var(--sl-badge-success-text)}.tip:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-tip-bg);--sl-color-border-badge: var(--sl-badge-tip-border);--sl-color-text-badge: var(--sl-badge-tip-text)}.caution:where(.astro-avdet4wd){--sl-color-bg-badge: var(--sl-badge-caution-bg);--sl-color-border-badge: var(--sl-badge-caution-border);--sl-color-text-badge: var(--sl-badge-caution-text)}.small:where(.astro-avdet4wd){font-size:var(--sl-text-xs);padding:.125rem .25rem}.medium:where(.astro-avdet4wd){font-size:var(--sl-text-sm);padding:.175rem .35rem}.large:where(.astro-avdet4wd){font-size:var(--sl-text-base);padding:.225rem .45rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) .sl-badge:where(.astro-avdet4wd){vertical-align:middle}
.card-grid:where(.astro-zntqmydn){display:grid;gap:1rem}.card-grid:where(.astro-zntqmydn)>*{margin-top:0!important}@media (min-width: 50rem){.card-grid:where(.astro-zntqmydn){grid-template-columns:1fr 1fr;gap:1.5rem}.stagger:where(.astro-zntqmydn){--stagger-height: 5rem;padding-bottom:var(--stagger-height)}.stagger:where(.astro-zntqmydn)>*:nth-child(2n){transform:translateY(var(--stagger-height))}}
.card:where(.astro-v5tidmuc){--sl-card-border: var(--sl-color-purple);--sl-card-bg: var(--sl-color-purple-low);border:1px solid var(--sl-color-gray-5);background-color:var(--sl-color-black);padding:clamp(1rem,calc(.125rem + 3vw),2.5rem);flex-direction:column;gap:clamp(.5rem,calc(.125rem + 1vw),1rem)}.card:where(.astro-v5tidmuc):nth-child(4n+1){--sl-card-border: var(--sl-color-orange);--sl-card-bg: var(--sl-color-orange-low)}.card:where(.astro-v5tidmuc):nth-child(4n+3){--sl-card-border: var(--sl-color-green);--sl-card-bg: var(--sl-color-green-low)}.card:where(.astro-v5tidmuc):nth-child(4n+4){--sl-card-border: var(--sl-color-red);--sl-card-bg: var(--sl-color-red-low)}.card:where(.astro-v5tidmuc):nth-child(4n+5){--sl-card-border: var(--sl-color-blue);--sl-card-bg: var(--sl-color-blue-low)}.title:where(.astro-v5tidmuc){font-weight:600;font-size:var(--sl-text-h4);color:var(--sl-color-white);line-height:var(--sl-line-height-headings);gap:1rem;align-items:center}.card:where(.astro-v5tidmuc) .icon:where(.astro-v5tidmuc){border:1px solid var(--sl-card-border);background-color:var(--sl-card-bg);padding:.2em;border-radius:.25rem}.card:where(.astro-v5tidmuc) .body:where(.astro-v5tidmuc){margin:0;font-size:clamp(var(--sl-text-sm),calc(.5rem + 1vw),var(--sl-text-body))}
svg:where(.astro-c6vsoqas){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}
.sl-steps{--bullet-size: calc(var(--sl-line-height) * 1rem);--bullet-margin: .375rem;list-style:none;counter-reset:steps-counter var(--sl-steps-start, 0);padding-inline-start:0}.sl-steps>li{counter-increment:steps-counter;position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(steps-counter);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:var(--sl-text-xs);font-weight:600;text-align:center;color:var(--sl-color-white);background-color:var(--sl-color-gray-6);border-radius:99rem;box-shadow:inset 0 0 0 1px var(--sl-color-gray-5)}.sl-steps>li:not(:last-of-type):after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:var(--sl-color-hairline-light)}.sl-steps>li>:first-child{--lh: calc(1em * var(--sl-line-height));--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));transform:translateY(var(--shift-y));margin-bottom:var(--shift-y)}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: calc(1em * var(--sl-line-height-headings))}@supports (--prop: 1lh){.sl-steps>li>:first-child{--lh: 1lh}}
</style><script type="module" src="/_astro/hoisted.DfIZDHVP.js"></script>
<script type="module" src="/_astro/page.LS5KDvwX.js"></script></head> <body class="astro-bguv2lll"> <a href="#_top" class="astro-7q3lir66">Skip to content</a>  <div class="page sl-flex astro-vrdttmbt"> <header class="header astro-vrdttmbt"><div class="header sl-flex astro-kmkmnagf"> <div class="title-wrapper sl-flex astro-kmkmnagf"> <a href="/" class="site-title sl-flex astro-m46x6ez3">  <img class="astro-m46x6ez3" alt="" src="/_astro/wow.Cken7KQM.png" width="512" height="509">  <span class="astro-m46x6ez3"> suchcodewow </span> </a>  </div> <div class="sl-flex astro-kmkmnagf"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" class="astro-v37mnknz"> <button data-open-modal disabled aria-label="Search" aria-keyshortcuts="Control+K" class="astro-v37mnknz"> <svg aria-hidden="true" class="astro-v37mnknz astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-v37mnknz" aria-hidden="true">Search</span> <kbd class="sl-hidden md:sl-flex astro-v37mnknz" style="display: none;"> <kbd class="astro-v37mnknz">Ctrl</kbd><kbd class="astro-v37mnknz">K</kbd> </kbd> </button> <dialog style="padding:0" aria-label="Search" class="astro-v37mnknz"> <div class="dialog-frame sl-flex astro-v37mnknz">  <button data-close-modal class="sl-flex md:sl-hidden astro-v37mnknz"> Cancel </button> <div class="search-container astro-v37mnknz"> <div id="starlight__search" class="astro-v37mnknz"></div> </div> </div> </dialog> </site-search>  <script>
	(() => {
		const openBtn = document.querySelector('button[data-open-modal]');
		const shortcut = openBtn?.querySelector('kbd');
		if (!openBtn || !(shortcut instanceof HTMLElement)) return;
		const platformKey = shortcut.querySelector('kbd');
		if (platformKey && /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)) {
			platformKey.textContent = '⌘';
			openBtn.setAttribute('aria-keyshortcuts', 'Meta+K');
		}
		shortcut.style.display = '';
	})();
</script>    </div> <div class="sl-hidden md:sl-flex right-group astro-kmkmnagf"> <div class="sl-flex social-icons astro-kmkmnagf"> <a href="https://github.com/suchcodewow/scwastro" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected="true" class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-vrdttmbt" aria-label="Main"> <starlight-menu-button class="astro-jif73yzw"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-jif73yzw"> <svg aria-hidden="true" class="astro-jif73yzw astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-vrdttmbt"> <div class="sidebar-content sl-flex astro-vrdttmbt"> <ul class="top-level astro-3ii7xxms">  </ul>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-wu23bvmt"> <div class="sl-flex social-icons astro-wu23bvmt"> <a href="https://github.com/suchcodewow/scwastro" rel="me" class="sl-flex astro-wy4te6ga"><span class="sr-only astro-wy4te6ga">GitHub</span><svg aria-hidden="true" class="astro-wy4te6ga astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-4yphtoen"> <span class="sr-only astro-4yphtoen">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-4yphtoen"> <option value="dark" class="astro-4yphtoen">Dark</option><option value="light" class="astro-4yphtoen">Light</option><option value="auto" selected="true" class="astro-4yphtoen">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-4yphtoen astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-vrdttmbt">  <div class="lg:sl-flex astro-67yu43on"> <aside class="right-sidebar-container astro-67yu43on"> <div class="right-sidebar astro-67yu43on"> <div class="lg:sl-hidden astro-pb3aqygn"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-doynk5tl"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-doynk5tl"><details id="starlight__mobile-toc" class="astro-doynk5tl"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-doynk5tl"><div class="toggle sl-flex astro-doynk5tl">On this page<svg aria-hidden="true" class="caret astro-doynk5tl astro-c6vsoqas" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-doynk5tl"></span></summary><div class="dropdown astro-doynk5tl"><ul class="isMobile astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a> <ul class="isMobile astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#whats-in-it-for-me" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">What’s in it for Me?</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#objective" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Objective</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#checkered_flag-checkpoint" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">:checkered_flag: Checkpoint</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#checkered_flag-checkpoint-1" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">:checkered_flag: Checkpoint</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#log-viewer" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Log viewer</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#checkered_flag-checkpoint-2" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">:checkered_flag: Checkpoint</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#for-reference" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">For Reference</span> </a>  </li> </ul>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-pb3aqygn"><div class="sl-container astro-pb3aqygn"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-g2bywc46" style="--depth: 0;"> <li class="astro-g2bywc46" style="--depth: 0;"> <a href="#_top" class="astro-g2bywc46" style="--depth: 0;"> <span class="astro-g2bywc46" style="--depth: 0;">Overview</span> </a> <ul class="astro-g2bywc46" style="--depth: 1;"> <li class="astro-g2bywc46" style="--depth: 1;"> <a href="#whats-in-it-for-me" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">What’s in it for Me?</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#objective" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Objective</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#checkered_flag-checkpoint" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">:checkered_flag: Checkpoint</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#checkered_flag-checkpoint-1" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">:checkered_flag: Checkpoint</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#log-viewer" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">Log viewer</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#checkered_flag-checkpoint-2" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">:checkered_flag: Checkpoint</span> </a>  </li><li class="astro-g2bywc46" style="--depth: 1;"> <a href="#for-reference" class="astro-g2bywc46" style="--depth: 1;"> <span class="astro-g2bywc46" style="--depth: 1;">For Reference</span> </a>  </li> </ul>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-67yu43on">  <main data-pagefind-body lang="en" dir="ltr" class="astro-bguv2lll">    <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <h1 id="_top" class="astro-j6tvhyss">Integrating fluentd</h1>  </div> </div>  <div class="content-panel astro-7nkwcw3z"> <div class="sl-container astro-7nkwcw3z"> <div class="sl-markdown-content"> <h1 id="integrating-fluentd">Integrating fluentd</h1>
<p>In this module we’ll learn how to integrate Dynatrace with Fluentd in Kubernetes.</p>
<h3 id="whats-in-it-for-me">What’s in it for Me?</h3>
<p>Learning these concepts will help your teams transform terabytes of logs into AI-powered answers and additional context for apps and infrastructure, at scale.</p>
<p>We will update our previous log stream pipeline to forward the generated log to dynatrace</p>
<h3 id="objective">Objective</h3>
<p>This exercise will :</p>
<ul>
<li>modify our current fluentd pipeline</li>
<li>utilize the log v2 viewer</li>
<li>create a dynatrace metric out of logs</li>
</ul>
<h4 id="restructuring-the-log-stream">Restructuring the log stream</h4>
<p>Fluentd has a output plugin dynatrace that will forward the generated log to the logs ingest API.
The log ingest API requires a specific format :</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.d6kn2.css"><script type="module" src="/_astro/ec.3zb7u.js"></script><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"content"</span><span style="--0:#C5E478;--1:#3C63B3">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">example log content 1</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#3C63B3">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"status"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">error</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#3C63B3">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"k8s.pod.name"</span><span style="--0:#C5E478;--1:#3C63B3">:</span><span style="--1:#3C63B3"><span style="--0:#82AAFF">"</span><span style="--0:#C5E478">$PODNAME</span><span style="--0:#82AAFF">"</span></span><span style="--0:#82AAFF;--1:#3C63B3">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"k8s.namespace.uid"</span><span style="--0:#C5E478;--1:#3C63B3">:</span><span style="--1:#3C63B3"><span style="--0:#82AAFF">"</span><span style="--0:#C5E478">$NAMESPACEID</span><span style="--0:#82AAFF">"</span></span><span style="--0:#82AAFF;--1:#3C63B3">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"dt.kubernetes.node.name"</span><span style="--0:#C5E478;--1:#3C63B3">:</span><span style="--1:#3C63B3"><span style="--0:#82AAFF">"</span><span style="--0:#C5E478">$NODENAME</span><span style="--0:#82AAFF">"</span></span><span style="--0:#82AAFF;--1:#3C63B3">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"dt.kubernetes.cluster.id"</span><span style="--0:#C5E478;--1:#3C63B3">:</span><span style="--1:#3C63B3"><span style="--0:#82AAFF">"</span><span style="--0:#C5E478">$CLUSTERID</span><span style="--0:#82AAFF">"</span></span><span style="--0:#82AAFF;--1:#3C63B3">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"dt.kubernetes.node.system_uuid"</span><span style="--0:#C5E478;--1:#3C63B3">:</span><span style="--1:#3C63B3"><span style="--0:#82AAFF">"</span><span style="--0:#C5E478">$DTNODEID</span><span style="--0:#82AAFF">"</span></span><span style="--0:#82AAFF;--1:#3C63B3">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"log.source"</span><span style="--0:#C5E478;--1:#3C63B3">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">/var/log/syslog</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#3C63B3">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"dt.entity.host"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">&#x3C;HOST ID></span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#3C63B3">,</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"dt.entity.process_group_instance"</span><span style="--0:#C5E478;--1:#3C63B3">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">&#x3C;PG_ID></span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">"response"</span><span style="--0:#82AAFF;--1:#3C63B3">:12</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{&#x22;content&#x22;: &#x22;example log content 1&#x22;,&#x22;status&#x22; : &#x22;error&#x22;,&#x22;k8s.pod.name&#x22;:&#x22;$PODNAME&#x22;,&#x22;k8s.namespace.uid&#x22;:&#x22;$NAMESPACEID&#x22;,&#x22;dt.kubernetes.node.name&#x22;:&#x22;$NODENAME&#x22;,&#x22;dt.kubernetes.cluster.id&#x22;:&#x22;$CLUSTERID&#x22;,&#x22;dt.kubernetes.node.system_uuid&#x22;:&#x22;$DTNODEID&#x22;,&#x22;log.source&#x22;: &#x22;/var/log/syslog&#x22;,&#x22;dt.entity.host&#x22; : &#x22;<HOST ID>&#x22;,&#x22;dt.entity.process_group_instance&#x22;: &#x22;<PG_ID>&#x22;&#x22;response&#x22;:12}"><div></div></button></div></figure></div>
<ul>
<li>The property content will have the value of our log.</li>
<li>Status is optional but helps to filter our content.</li>
<li>Log.source is also optional.</li>
<li>The other labels are there to help dynatrace to index the log stream to the right entity.</li>
</ul>
<p>We can add as many extra properties to attach extra labels related to our log stream.
Several labels will be used to index the log stream to a given Dynatrace entity.</p>
<h4 id="how-to-restructure-our-logs">How to restructure our logs</h4>
<p>Fluentd has a plugin that will helps us to restructure the produced log stream : <code dir="auto">record_transformer</code></p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">record_transformer</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">enable_ruby</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;record></span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">content</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">method</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">request</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">status</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">service</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">bytes_sent</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">responsetime</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">service</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/record></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="@type record_transformerenable_ruby true<record>content ${record[&#x22;method&#x22;]} ${record[&#x22;request&#x22;]} ${record[&#x22;status&#x22;]} ${record[&#x22;service&#x22;]} ${record[&#x22;bytes_sent&#x22;]} ${record[&#x22;responsetime&#x22;]} ${record[&#x22;service&#x22;]}</record>"><div></div></button></div></figure></div>
<p><code dir="auto">&#x3C;record>&#x3C;/record></code> will help us to re structure our log stream before sending it to dynatrace.</p>
<p>In the record object you can add any number of labels.</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;record></span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">labelname</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">value</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/record></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<record>labelname value</record>"><div></div></button></div></figure></div>
<p>record can retrieve the value of existing fluentd keys with :</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">keyname</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="${record[&#x22;keyname&#x22;]}"><div></div></button></div></figure></div>
<p>To fully index a log stream to a Pod, node, k8s cluster it is required to add the following labels :</p>
<ul>
<li><code dir="auto">dt.kubernetes.node.name</code></li>
<li><code dir="auto">dt.kubernetes.node.system_uuid</code></li>
<li><code dir="auto">k8s.pod.labels</code></li>
<li><code dir="auto">dt.kubernetes.cluster.id</code></li>
<li><code dir="auto">k8s.namespace.uid</code></li>
<li><code dir="auto">k8s.namespace.name</code></li>
<li><code dir="auto">k8s.pod.name</code></li>
<li><code dir="auto">k8s.pod.uid</code></li>
</ul>
<p>To add this filter, edit your fluentd config map:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">kubectl</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">edit</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">cm</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">fluentd-conf</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">-n</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nondynatrace</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="kubectl edit cm fluentd-conf -n nondynatrace"><div></div></button></div></figure></div>
<p>Below your super awesome nginx filter with the labels and defined metrics, add this section:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;filter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">record_transformer</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">enable_ruby</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">true</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;record></span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">status</span><span style="--0:#D6DEEB;--1:#403F53"> ${ </span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#C5E478;--1:#3C63B3">dig</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C5E478;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C5E478;--1:#3C63B3">severity</span><span style="--0:#D6DEEB;--1:#403F53">) || </span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#C5E478;--1:#3C63B3">dig</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C5E478;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C5E478;--1:#3C63B3">level</span><span style="--0:#D6DEEB;--1:#403F53">) || (</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">log</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">] =~ </span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#F78C6C;--1:#AA0982">\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#F78C6C;--1:#AA0982">\b</span><span style="--0:#D6DEEB;--1:#403F53">error</span><span style="--0:#F78C6C;--1:#AA0982">\b\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> ? </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">ERROR</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">log</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">] =~ </span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#F78C6C;--1:#AA0982">\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#F78C6C;--1:#AA0982">\b</span><span style="--0:#D6DEEB;--1:#403F53">warn</span><span style="--0:#F78C6C;--1:#AA0982">\b\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> ? </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">WARN</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">log</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">] =~ </span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#F78C6C;--1:#AA0982">\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#F78C6C;--1:#AA0982">\b</span><span style="--0:#D6DEEB;--1:#403F53">debug</span><span style="--0:#F78C6C;--1:#AA0982">\b\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> ? </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">DEBUG</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">log</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">] =~ </span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#F78C6C;--1:#AA0982">\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#F78C6C;--1:#AA0982">\b</span><span style="--0:#D6DEEB;--1:#403F53">info</span><span style="--0:#F78C6C;--1:#AA0982">\b\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> ? </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">INFO</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">NONE</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)))) }</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">content</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">method</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">request</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">status</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">service</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">bytes_sent</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">responsetime</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">service</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">dt.kubernetes.node.system_uuid</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">File</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#C5E478;--1:#3C63B3">read</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">/sys/devices/virtual/dmi/id/product_uuid</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">).</span><span style="--0:#C5E478;--1:#3C63B3">strip</span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">dt.kubernetes.cluster.id</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">#{ENV['CLUSTER_ID']}</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">k8s.namespace.name</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">resource_namespace</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">k8s.service.name</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">service</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]}</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/record></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">remove_keys</span><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#ECC48D;--1:#3C63B3">nginx</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/filter></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<filter nginx>       @type record_transformer       enable_ruby true       <record>         status ${ record.dig(:log, :severity) || record.dig(:log, :level) || (record[&#x22;log&#x22;] =~ /\W?\berror\b\W?/i ? &#x22;ERROR&#x22; : (record[&#x22;log&#x22;] =~ /\W?\bwarn\b\W?/i ? &#x22;WARN&#x22; : (record[&#x22;log&#x22;] =~ /\W?\bdebug\b\W?/i ? &#x22;DEBUG&#x22; : (record[&#x22;log&#x22;] =~ /\W?\binfo\b\W?/i ? &#x22;INFO&#x22; : &#x22;NONE&#x22;)))) }         content ${record[&#x22;method&#x22;]} ${record[&#x22;request&#x22;]} ${record[&#x22;status&#x22;]} ${record[&#x22;service&#x22;]} ${record[&#x22;bytes_sent&#x22;]} ${record[&#x22;responsetime&#x22;]} ${record[&#x22;service&#x22;]}         dt.kubernetes.node.system_uuid ${File.read(&#x22;/sys/devices/virtual/dmi/id/product_uuid&#x22;).strip}         dt.kubernetes.cluster.id &#x22;#{ENV[&#x27;CLUSTER_ID&#x27;]}&#x22;         k8s.namespace.name ${record[&#x22;resource_namespace&#x22;]}         k8s.service.name ${record[&#x22;service&#x22;]}       </record>       remove_keys  nginx     </filter>"><div></div></button></div></figure></div>
<ul>
<li>The status line looks like a lot! But it simply uses an <code dir="auto">or</code> ( || ) command to normalize the status into one of error/warn/debug/info.</li>
<li>The content line combines several fields that we want to export into a single “packet” of data.</li>
<li>The remaining fields are split out individuals because they are used individually by Dynatrace to index and dimension data.</li>
</ul>
<p>Incidentally, if your log stream does not have the details limit to the available information you can easily retrieve the to fields with :</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">dt.kubernetes.cluster.id</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">#{ENV['CLUSTER_ID']}</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">dt.kubernetes.node.system_uuid</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">File</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#C5E478;--1:#3C63B3">read</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">/sys/devices/virtual/dmi/id/product_uuid</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">).</span><span style="--0:#C5E478;--1:#3C63B3">strip</span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="dt.kubernetes.cluster.id &#x22;#{ENV[&#x27;CLUSTER_ID&#x27;]}&#x22;dt.kubernetes.node.system_uuid ${File.read(&#x22;/sys/devices/virtual/dmi/id/product_uuid&#x22;).strip}"><div></div></button></div></figure></div>
<h3 id="checkered_flag-checkpoint">:checkered_flag: Checkpoint</h3>
<p>Please take a moment to mark the spreadsheet <em>fluentd - Restructued Logs</em> column for your row with <code dir="auto">done</code>.</p>
<h4 id="remove-log-streams-that-are-not-related-to-http-traffic-going-through-the-ingress">remove log streams that are not related to http traffic going through the ingress</h4>
<p>Every request coming in our ingress are normally made to be routed to a specific service.
Nginx could also log k8s health, live checks that won’t mach any of our back-end rule.
Therefore, to avoid pushing non-meaningful or non structured data, we should filter http request that won’t route ( without ingress name, service, …etc)</p>
<p>Fluentd has a filter plugin <code dir="auto">grep</code> that will help us to exclude data.</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;filter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">grep</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;exclude></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/exclude></span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/filter></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<filter nginx>    @type grep    <exclude>    </exclude></filter>"><div></div></button></div></figure></div>
<p>The exclusion rules requires specifying with log stream we want to apply a grep pattern :</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;filter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">grep</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;exclude></span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3C63B3">key</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">log_streamkey</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3C63B3">pattern</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">/regexp/</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/exclude></span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/filter></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<filter nginx>    @type grep    <exclude>          key log_streamkey          pattern /regexp/    </exclude></filter>"><div></div></button></div></figure></div>
<p>In our example we would like to filter the logs stream where the key service is empty.</p>
<p>The regexp excluding empty string is : <code dir="auto">/^$/</code></p>
<p>Modify the logstream pipeline by adding the filter that will exclude log stream having an empty service right above your <code dir="auto">record transformer filter</code>:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;filter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">grep</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;exclude></span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3C63B3">key</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">service</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3C63B3">pattern</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">/^</span><span style="--0:#D6DEEB;--1:#403F53">$</span><span style="--0:#ECC48D;--1:#3C63B3">/</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/exclude></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/filter></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;filter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span><span style="--0:#D6DEEB;--1:#403F53"> (following </span><span style="--0:#ECC48D;--1:#3C63B3">filter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">already</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">there-</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">do</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">not</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">add!</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<filter nginx>        @type grep          <exclude>          key service          pattern /^$/          </exclude>     </filter>     <filter nginx> (following filter already there- do not add!)"><div></div></button></div></figure></div>
<h4 id="add-the-record-transformer-to-your-logstream">Add the record transformer to your logstream</h4>
<p><img src="/_astro/dt_fluentd_record_transformer.CMgIyCdA_20o8yT.webp" alt="fluentd_2_1" width="1873" height="99" loading="lazy" decoding="async"></p>
<h4 id="add-the-dynatrace-output-plugin">Add the dynatrace output plugin</h4>
<p>Now that we’re done building our environment we want to stop exporting everything to stdout and send it to Dynatrace instead.
The fluentd container deployed in the cluster has already the dynatrace plugin installed.
The fluentd plugin is opensource and documented <a href="https://github.com/dynatrace-oss/fluent-plugin-dynatrace">here</a></p>
<p>The plugin will have specific propeties to define :</p>
<ul>
<li>the url of your activegate-</li>
<li>the api_token ( having the log ingest right)</li>
</ul>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53">              </span><span style="--0:#ECC48D;--1:#3C63B3">dynatrace</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">active_gate_url</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">#{ENV['AG_INGEST_URL']}</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">api_token</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">#{ENV['LOG_INGEST_TOKEN']}</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">ssl_verify_none</span><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">true</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/match></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<match nginx>    @type              dynatrace    active_gate_url &#x22;#{ENV[&#x27;AG_INGEST_URL&#x27;]}&#x22;    api_token &#x22;#{ENV[&#x27;LOG_INGEST_TOKEN&#x27;]}&#x22;    ssl_verify_none    true</match>"><div></div></button></div></figure></div>
<p>Remove the match using the stdout plugin and replace it with dynatrace plugin (code above).</p>
<p>Remember to reset your fluentd pods:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">kubectl</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">delete</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">pods</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">-n</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nondynatrace</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">-l</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">app=fluentd-pipeline</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="kubectl delete pods -n nondynatrace -l app=fluentd-pipeline"><div></div></button></div></figure></div>
<p>If your load generator script stopped, start it up again in another terminal:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#7FDBCA;--1:#097174">~</span><span style="--0:#D6DEEB;--1:#403F53">/hotday_script/load/generateTraffic.sh</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="~/hotday_script/load/generateTraffic.sh"><div></div></button></div></figure></div>
<h3 id="checkered_flag-checkpoint-1">:checkered_flag: Checkpoint</h3>
<p>Please take a moment to mark the spreadsheet <em>fluentd - switched to Dynatrace plugin</em> column for your row with <code dir="auto">done</code>.</p>
<h3 id="log-viewer">Log viewer</h3>
<p>All the ingested logs from the dynatrace Operator and from fluentd will be available in the Log viewer.
Click on the left menu Observe and Explore/Logs
<img src="/_astro/dt_fluentd_logviewer.Cx705UQ8_Z3LYtf.webp" alt="fluentd_2_2" width="1635" height="927" loading="lazy" decoding="async"></p>
<h4 id="filter-the-logs-to-see-our-logs">Filter the logs to see our logs</h4>
<p>To create a metric out of a log stream requires to create the right log filter.
Look a the log properties of fluentd, and create the filter that will only show logs related to our application.
<img src="/_astro/dt_fluentd_log_detail.CgxYELC0_ZF4fgi.webp" alt="fluentd_2_3" width="1222" height="767" loading="lazy" decoding="async"></p>
<h4 id="create-a-metric-out-of-our-logs">Create a metric out of our logs</h4>
<p>Create a metric exposing the label <code dir="auto">responsetime</code> time ingested by dynatrace
<img src="/_astro/dt_fluentd_log_create_metric.B-PL4-6m_Z2oTgAB.webp" alt="fluentd_2_4" width="1316" height="747" loading="lazy" decoding="async"></p>
<h4 id="create-traffic-to-generate-new-logs">Create traffic to generate new logs</h4>
<p>The metric only exists from the moment new log stream has been ingested by dynatrace.
Confirm that you are generating traffic or restart it with:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">/hotday_script/load/generateTraffic.sh</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="/hotday_script/load/generateTraffic.sh"><div></div></button></div></figure></div>
<p>Once the metric exist go to the Data explorer and create a new Graph with your metric.</p>
<h3 id="checkered_flag-checkpoint-2">:checkered_flag: Checkpoint</h3>
<p>Please take a moment to mark the spreadsheet <em>fluentd - Created Log Graph</em> column for your row with <code dir="auto">done</code>.</p>
<h3 id="for-reference">For Reference</h3>
<p>The completed fluentd-conf map can be deployed via:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">kubectl</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apply</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">-f</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">~/hotday_script/fluentd/fluentd-configmap-dynatrace.yaml</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="kubectl apply -f ~/hotday_script/fluentd/fluentd-configmap-dynatrace.yaml"><div></div></button></div></figure></div>
<p>Here is the full config map for fluentd-conf:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">apiVersion:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">v1</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">kind:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">ConfigMap</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">metadata:</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">name:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">fluentd-conf</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">namespace:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nondynatrace</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">labels:</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">app:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">fluentd</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3C63B3">component:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">fluentd-conf</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">data:</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">CLUSTER_ID:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">CLUSTER_ID_TO_REPLACE</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">AG_INGEST_URL:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">https://fluentd-activegate:9999/e/ENVIRONMENT_ID_TO_REPLACE/api/v2/logs/ingest</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">fluent.conf:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">|</span><span style="--0:#82AAFF;--1:#3C63B3">-</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#809191;--1:#616671"># Ingest logs from nodes</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">fluent.</span><span style="--0:#7FDBCA;--1:#097174">**</span><span style="--0:#ECC48D;--1:#3C63B3">></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">null</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/match></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;source></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">tail</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">path</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">/var/log/containers/</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#ECC48D;--1:#3C63B3">nginx</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#ECC48D;--1:#3C63B3">.log</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">pos_file</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">/var/log/fluentd.pos</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">time_format</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">%Y-%m-%dT%H:%M:%S.%NZ</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">read_from_head</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">true</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">tag</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">keep_time_key</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">true</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;parse></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">reserve_data</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">yes</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">expression</span><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#ECC48D;--1:#3C63B3">/^</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;ip></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#D6DEEB;--1:#403F53">+)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#F78C6C;--1:#AA0982">\[</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;time_local>[^</span><span style="--0:#F78C6C;--1:#AA0982">\]</span><span style="--0:#D6DEEB;--1:#403F53">]</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\]\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;method></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#D6DEEB;--1:#403F53">+)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;request></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#D6DEEB;--1:#403F53">+)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;httpversion></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;status></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;bytes_sent></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;responsetime></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;proxy></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;upstream_responsetime></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;resourcename></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;upstream_status></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;ingress_name></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;resource_type></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;resource_namespace></span><span style="--0:#F78C6C;--1:#AA0982">\S</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#F78C6C;--1:#AA0982">\s</span><span style="--0:#ECC48D;--1:#3C63B3">+</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">?</span><span style="--0:#D6DEEB;--1:#403F53">&#x3C;service></span><span style="--0:#F78C6C;--1:#AA0982">\w</span><span style="--0:#7FDBCA;--1:#097174">*</span><span style="--0:#D6DEEB;--1:#403F53">)</span><span style="--0:#ECC48D;--1:#3C63B3">/</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">types</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">ip:string,time_local:string,method:string,request:string,httpversion:string,status:string,bytes_sent:integer,responsetime:float,proxy:string,upstream_responsetime:integer,resourcename:string,upstream_status:string,ingress_name:string,resource_type:string,resource_namespace:string,service:string</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">time_key</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">time_local</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">time_format</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">%d/%b/%Y:%H:%M:%S</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">%z</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/parse></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/source></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;source></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">prometheus</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">bind</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">0.0.0.0</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">port</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">9914</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">metrics_path</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">/metrics</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/source></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;filter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">kubernetes_metadata</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/filter></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;filter</span><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span></div></div><div class="ec-line"><div class="code"><span class="indent">      </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">prometheus</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;labels></span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">method</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">method</span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">request</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">request</span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">status</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">status</span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">namespace</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">resource_namespace</span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">service</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">service</span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">ressourcename</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">resourcename</span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/labels></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;metric></span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">name</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">hotday_response_time</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#C5E478;--1:#3C63B3">type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">gauge</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">desc</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">response</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">time</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">key</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">responsetime</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/metric></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;metric></span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">name</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">hotday_byte_sent</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#C5E478;--1:#3C63B3">type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">gauge</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">desc</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">byte</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">sent</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">key</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">bytes_sent</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/metric></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;metric></span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">name</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">hotday_requests</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#C5E478;--1:#3C63B3">type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">counter</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">desc</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">The</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">total</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">number</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">of</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">request</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/metric></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;metric></span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">name</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">hotday_status</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#C5E478;--1:#3C63B3">type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">counter</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">desc</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">status</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">code</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">key</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">status</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/metric></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/filter></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;filter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">grep</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;exclude></span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3C63B3">key</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">service</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3C63B3">pattern</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">/^</span><span style="--0:#D6DEEB;--1:#403F53">$</span><span style="--0:#ECC48D;--1:#3C63B3">/</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#809191;--1:#616671"># or, to exclude all messages that are empty or include only white-space:</span></div></div><div class="ec-line"><div class="code"><span class="indent">          </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/exclude></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/filter></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;filter</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">record_transformer</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">enable_ruby</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">true</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;record></span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">status</span><span style="--0:#D6DEEB;--1:#403F53"> ${ </span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#C5E478;--1:#3C63B3">dig</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C5E478;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C5E478;--1:#3C63B3">severity</span><span style="--0:#D6DEEB;--1:#403F53">) || </span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#C5E478;--1:#3C63B3">dig</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C5E478;--1:#3C63B3">log</span><span style="--0:#D6DEEB;--1:#403F53">, </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#C5E478;--1:#3C63B3">level</span><span style="--0:#D6DEEB;--1:#403F53">) || (</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">log</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">] =~ </span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#F78C6C;--1:#AA0982">\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#F78C6C;--1:#AA0982">\b</span><span style="--0:#D6DEEB;--1:#403F53">error</span><span style="--0:#F78C6C;--1:#AA0982">\b\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> ? </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">ERROR</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">log</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">] =~ </span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#F78C6C;--1:#AA0982">\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#F78C6C;--1:#AA0982">\b</span><span style="--0:#D6DEEB;--1:#403F53">warn</span><span style="--0:#F78C6C;--1:#AA0982">\b\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> ? </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">WARN</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">log</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">] =~ </span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#F78C6C;--1:#AA0982">\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#F78C6C;--1:#AA0982">\b</span><span style="--0:#D6DEEB;--1:#403F53">debug</span><span style="--0:#F78C6C;--1:#AA0982">\b\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> ? </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">DEBUG</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> (</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">log</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">] =~ </span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#F78C6C;--1:#AA0982">\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#F78C6C;--1:#AA0982">\b</span><span style="--0:#D6DEEB;--1:#403F53">info</span><span style="--0:#F78C6C;--1:#AA0982">\b\W</span><span style="--0:#D6DEEB;--1:#403F53">?</span><span style="--0:#7FDBCA;--1:#097174">/</span><span style="--0:#C5E478;--1:#3C63B3">i</span><span style="--0:#D6DEEB;--1:#403F53"> ? </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">INFO</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">NONE</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">)))) }</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">content</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">method</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">request</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">status</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">service</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">bytes_sent</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">responsetime</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]} ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">service</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">dt.kubernetes.node.system_uuid</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">File</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#C5E478;--1:#3C63B3">read</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">/sys/devices/virtual/dmi/id/product_uuid</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">).</span><span style="--0:#C5E478;--1:#3C63B3">strip</span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">dt.kubernetes.cluster.id</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">#{ENV['CLUSTER_ID']}</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">k8s.namespace.name</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">resource_namespace</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]}</span></div></div><div class="ec-line"><div class="code"><span class="indent">         </span><span style="--0:#82AAFF;--1:#3C63B3">k8s.service.name</span><span style="--0:#D6DEEB;--1:#403F53"> ${</span><span style="--0:#C5E478;--1:#3C63B3">record</span><span style="--0:#D6DEEB;--1:#403F53">[</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">service</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">]}</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/record></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">remove_keys</span><span style="--0:#D6DEEB;--1:#403F53">  </span><span style="--0:#ECC48D;--1:#3C63B3">nginx</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/filter></span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;match</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">nginx></span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">@type</span><span style="--0:#D6DEEB;--1:#403F53">              </span><span style="--0:#ECC48D;--1:#3C63B3">dynatrace</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">active_gate_url</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">#{ENV['AG_INGEST_URL']}</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">api_token</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#9B504E">#{ENV['LOG_INGEST_TOKEN']}</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#82AAFF;--1:#3C63B3">ssl_verify_none</span><span style="--0:#D6DEEB;--1:#403F53">    </span><span style="--0:#82AAFF;--1:#3C63B3">true</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#82AAFF;--1:#3C63B3">&#x3C;/match></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="apiVersion: v1kind: ConfigMapmetadata:  name: fluentd-conf  namespace: nondynatrace  labels:    app: fluentd    component: fluentd-confdata:  CLUSTER_ID: &#x22;CLUSTER_ID_TO_REPLACE&#x22;  AG_INGEST_URL: &#x22;https://fluentd-activegate:9999/e/ENVIRONMENT_ID_TO_REPLACE/api/v2/logs/ingest&#x22;  fluent.conf: |-     <match fluent.**>      @type null     </match>     <source>       @type tail       path /var/log/containers/*nginx*.log       pos_file /var/log/fluentd.pos       time_format %Y-%m-%dT%H:%M:%S.%NZ       read_from_head true       tag nginx       keep_time_key true     <parse>       @type nginx       reserve_data yes       expression  /^(?<ip>\S+)\s+\[(?<time_local>[^\]]*)\]\s+(?<method>\S+)\s+(?<request>\S+)\s+(?<httpversion>\S*)\s+(?<status>\S*)\s+(?<bytes_sent>\S*)\s+(?<responsetime>\S*)\s+(?<proxy>\S*)\s+(?<upstream_responsetime>\S*)\s+(?<resourcename>\S*)\s+(?<upstream_status>\S*)\s+(?<ingress_name>\S*)\s+(?<resource_type>\S*)\s+(?<resource_namespace>\S*)\s+(?<service>\w*)/       types ip:string,time_local:string,method:string,request:string,httpversion:string,status:string,bytes_sent:integer,responsetime:float,proxy:string,upstream_responsetime:integer,resourcename:string,upstream_status:string,ingress_name:string,resource_type:string,resource_namespace:string,service:string       time_key time_local       time_format %d/%b/%Y:%H:%M:%S %z     </parse>     </source>     <source>       @type prometheus       bind 0.0.0.0       port 9914       metrics_path /metrics     </source>     <filter nginx>       @type kubernetes_metadata     </filter>     <filter  nginx>      @type prometheus       <labels>         method ${method}         request ${request}         status ${status}         namespace ${resource_namespace}         service ${service}         ressourcename ${resourcename}       </labels>       <metric>         name hotday_response_time         type gauge         desc response time         key responsetime       </metric>       <metric>         name hotday_byte_sent         type gauge         desc byte sent         key bytes_sent       </metric>       <metric>         name hotday_requests         type counter         desc The total number of request       </metric>       <metric>         name hotday_status         type counter         desc status code         key status       </metric>     </filter>     <filter nginx>        @type grep          <exclude>          key service          pattern /^$/          </exclude>     </filter>     <filter nginx>       @type record_transformer       enable_ruby true       <record>         status ${ record.dig(:log, :severity) || record.dig(:log, :level) || (record[&#x22;log&#x22;] =~ /\W?\berror\b\W?/i ? &#x22;ERROR&#x22; : (record[&#x22;log&#x22;] =~ /\W?\bwarn\b\W?/i ? &#x22;WARN&#x22; : (record[&#x22;log&#x22;] =~ /\W?\bdebug\b\W?/i ? &#x22;DEBUG&#x22; : (record[&#x22;log&#x22;] =~ /\W?\binfo\b\W?/i ? &#x22;INFO&#x22; : &#x22;NONE&#x22;)))) }         content ${record[&#x22;method&#x22;]} ${record[&#x22;request&#x22;]} ${record[&#x22;status&#x22;]} ${record[&#x22;service&#x22;]} ${record[&#x22;bytes_sent&#x22;]} ${record[&#x22;responsetime&#x22;]} ${record[&#x22;service&#x22;]}         dt.kubernetes.node.system_uuid ${File.read(&#x22;/sys/devices/virtual/dmi/id/product_uuid&#x22;).strip}         dt.kubernetes.cluster.id &#x22;#{ENV[&#x27;CLUSTER_ID&#x27;]}&#x22;         k8s.namespace.name ${record[&#x22;resource_namespace&#x22;]}         k8s.service.name ${record[&#x22;service&#x22;]}       </record>       remove_keys  nginx     </filter>     <match nginx>       @type              dynatrace       active_gate_url &#x22;#{ENV[&#x27;AG_INGEST_URL&#x27;]}&#x22;       api_token &#x22;#{ENV[&#x27;LOG_INGEST_TOKEN&#x27;]}&#x22;       ssl_verify_none    true     </match>"><div></div></button></div></figure></div> </div> <footer class="sl-flex astro-3yyafb3n"> <div class="meta sl-flex astro-3yyafb3n">   </div> <div class="pagination-links astro-u2l5gyhi" dir="ltr">   </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>